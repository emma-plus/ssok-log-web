# AI 분석 파이프라인 - 유사어 분석 시스템

## 개요
이 프로젝트는 사용자가 입력한 답변과 정답 간의 유사도를 AI로 분석하여, 운영자가 유사어 후보들을 승인/거절할 수 있는 웹 기반 시스템입니다.

/*
=============================================================================
프로젝트 구조 및 설계 Documentation
=============================================================================

## 시스템 아키텍처

### 1. 전체 구조
```
index.html (메인 UI)
├── config.js (API 키 설정)
├── similarity.js (유사도 계산 모듈) 
└── preprocessing.js (텍스트 전처리 모듈)
```

### 2. 핵심 처리 플로우
```
데이터 입력 → 파싱 → 그룹핑 → 전처리 → 임베딩 → 유사도 계산 → 결과 표시
```

### 3. 데이터 처리 과정

#### 3.1 데이터 파싱 및 그룹핑
- CSV/TSV 형태의 로그 데이터를 파싱
- 정답별로 사용자 답변들을 그룹핑
- 중복 제거 및 빈도수 계산

#### 3.2 텍스트 전처리 (preprocessing.js)
- **Step 1**: 한글 숫자 → 아라비아 숫자 (일→1, 이→2, 팔→8)
- **Step 2**: 소수점 표현 정규화 (점/쩜→., 8점9→8.9)
- **Step 3**: 단위 정규화 (m→미터, %→퍼센트, g→그램)
- **Step 4**: 숫자 → 한글 변환 (8.9→팔점구, 4400→사천사백)

#### 3.3 임베딩 생성
- OpenAI text-embedding API를 통해 벡터 임베딩 생성
- 선택된 전처리 단계별로 임베딩 계산

#### 3.4 유사도 계산 (similarity.js)
- **기준점**: 정답의 임베딩 벡터
- **측정 대상**: 사용자 발화의 임베딩 벡터
- **계산 방식 및 유사도 해석**: 
  - **코사인 유사도**: 벡터 간 각도/방향 측정 (0~1, 1에 가까울수록 의미적으로 유사)
    - 0.9 이상: 매우 높은 유사도 (거의 동일한 의미)
    - 0.7~0.9: 높은 유사도 (유사한 의미)
    - 0.5~0.7: 중간 유사도 (관련성 있음)
    - 0.5 미만: 낮은 유사도 (관련성 낮음)
  - **유클리디안 유사도**: 벡터 간 직선 거리를 유사도로 변환 (1.0에 가까울수록 유사)
  - **맨하탄 유사도**: 벡터 간 격자 거리를 유사도로 변환 (1.0에 가까울수록 유사)
  - **기타 유사도 메트릭**: 다양한 거리 계산 방식으로 종합 판단

### 4. 주요 기능 및 최신 업데이트

#### 4.1 멀티 모델 지원
- text-embedding-3-small (기본, 경제적)
- text-embedding-3-large (고정밀, 비용 높음)
- UI에서 모델 선택 가능

#### 4.2 유연한 전처리 옵션
- 원본, 1-3단계, 1-4단계 중 선택적 활성화
- 각 단계별 유사도 비교 및 최적 방법 자동 선택
- 체크박스로 분석할 단계 커스터마이징

#### 4.3 디버그 레벨 제어
- 레벨 0: 기본 로그
- 레벨 1: 상세 로그  
- 레벨 2: 모든 로그 (전처리 과정, 임베딩 상세 정보)
- UI에서 실시간 조정 가능

#### 4.4 지원 데이터 타입
- **단어 형태**: 단순 유사어 분석 (WIP)
- **문장 형태**: 키워드 포함 여부 + 유사도 분석 (TOBE)

### 5. 사용자 인터페이스
- 반응형 다크 테마 디자인
- 실시간 승인/거절 상태 표시
- 상세 유사도 정보 토글 가능
- 전처리 비교 결과 시각화
- JSON 형태 결과 내보내기

=============================================================================

## 기능
1. **데이터 분석**: CSV/TSV 형태의 데이터를 파싱하고 그룹핑
2. **AI 분석**: OpenAI의 임베딩 모델을 사용한 유사도 분석 (multiple models 지원)
3. **텍스트 전처리**: 4단계 전처리 파이프라인 (선택적 적용)
4. **운영자 UI**: 분석 결과를 시각적으로 표시하고 승인/거절 관리
5. **디버그 모드**: 3단계 로그 레벨로 분석 과정 모니터링

## 사용 방법

### 1. 파일 실행
`index.html` 파일을 브라우저에서 열기

### 2. API 키 설정
OpenAI API 키를 입력란에 입력

### 3. 데이터 입력
CSV 형식의 데이터를 텍스트 영역에 입력
- 형식: `컬럼1,퀴즈ID,컬럼3,컬럼4,컬럼5,컬럼6,컬럼7,정답,컬럼9,사용자답변`
- 예시 데이터는 `데이터 형식` 참고

### 4. 분석 실행
"분석 시작" 버튼 클릭

### 5. 결과 확인 및 승인/거절
- 각 정답별로 유사어 후보들이 유사도와 출현횟수와 함께 표시됩니다
- 각 후보에 대해 "승인" 또는 "거절" 버튼으로 관리할 수 있습니다 (TOBE)

## 데이터 형식
```
47,1234,15,false,,WORD_SIMILARITY_PASS_FAIL_V2,,스냅드래곤 8,,스냅드래 곰파에
```

## 출력 형식
```json
[
  {
    "id": 1,
    "quiz_id": "6499",
    "expected_answer": "스냅드래곤 8",
    "candidates": [
      {"word": "스냅드래곤", "similarity": 0.91, "count": 1},
      {"word": "스냅드래 곰파에", "similarity": 0.88, "count": 1},
      {"word": "스냅드레곤", "similarity": 0.85, "count": 1}
    ]
  }
]
```

## 필요사항
- OpenAI API 키

## 주요 특징
- 유사도에 따른 색상 구분 (높음: 초록, 중간: 주황, 낮음: 빨강)
- 실시간 승인/거절 상태 표시


