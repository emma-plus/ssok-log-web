# AI 분석 파이프라인 - 유사어 분석 시스템 with STT 메트릭

## 개요
이 프로젝트는 사용자가 입력한 답변과 정답 간의 유사도를 AI로 분석하여, 운영자가 유사어 후보들을 승인/거절할 수 있는 웹 기반 시스템입니다. STT(Speech-to-Text) 특화 메트릭을 포함한 다양한 유사도 계산 방식을 지원합니다.

/*
=============================================================================
프로젝트 구조 및 설계 Documentation
=============================================================================

## 시스템 아키텍처

### 1. 전체 구조
```
index.html (메인 분석 UI)
├── load-json.html (JSON 결과 뷰어)
├── config.js (API 키 설정)
├── parser.js (데이터 파싱 및 그룹핑 모듈)
├── similarity.js (유사도 계산 모듈)
├── stt-similarity.js (STT 특화 유사도 모듈)
├── preprocessing.js (텍스트 전처리 모듈)
├── displayResults.js (결과 표시 및 렌더링 모듈)
├── management.js (승인/거절, 내보내기 관리)
└── styles.css (다크 테마 스타일)
```

### 2. 핵심 처리 플로우
```
데이터 입력 → 파싱 → 그룹핑 → 전처리 → 임베딩 → 유사도 계산 (STT 메트릭 포함) → 결과 표시
```

### 3. 데이터 처리 과정

#### 3.1 데이터 파싱 및 그룹핑
- CSV/TSV 형태의 로그 데이터를 파싱 (자동 구분자 감지)
- 정답별로 사용자 답변들을 그룹핑
- 중복 제거 및 빈도수 계산

#### 3.2 텍스트 전처리 (preprocessing.js)
**정방향 전처리:**
- **Step 1**: 한글 숫자 → 아라비아 숫자 (일→1, 이→2, 팔→8)
- **Step 2**: 소수점 표현 정규화 (점/쩜→., 8점9→8.9)
- **Step 3**: 단위 정규화 (m→미터, %→퍼센트, g→그램)
- **Step 4**: 숫자 → 한글 변환 (8.9→팔점구, 4400→사천사백)

**역방향 전처리 (제거됨 - 품질 저하로 인한 테스트 후 삭제):**
- **R1-R3**: 한글→숫자, 소수점 정규화, 한글단위→영문
  - 예시: "팔점구 미터" → "8.9 m"
- **R1-R4**: R1-R3 + 복합 한글숫자→아라비아
  - 예시: "사천사백" → "4400"
- **테스트 결과**: 유사도 품질이 정방향 전처리보다 현저히 낮아 제거됨
- **문제점**: 한글→숫자 변환 과정에서 의미 왜곡 및 정확도 하락

#### 3.3 임베딩 생성
- OpenAI text-embedding API를 통해 벡터 임베딩 생성
- 선택된 전처리 단계별로 임베딩 계산
- 중복 텍스트 최적화로 API 호출 절약
- 배치 처리 지원 (최대 2048개)

#### 3.4 하이브리드 유사도 계산 (similarity.js + stt-similarity.js)
**임베딩 기반 유사도:**
- **기준점**: 정답의 임베딩 벡터
- **측정 대상**: 사용자 발화의 임베딩 벡터
- **코사인 유사도**: 벡터 간 각도/방향 측정 (0~1, 1에 가까울수록 의미적으로 유사)
  - 0.9 이상: 매우 높은 유사도 (거의 동일한 의미)
  - 0.7~0.9: 높은 유사도 (유사한 의미)
  - 0.5~0.7: 중간 유사도 (관련성 있음)
  - 0.5 미만: 낮은 유사도 (관련성 낮음)
- **유클리디안/맨하탄**: 벡터 간 거리 기반 유사도
- **피어슨 상관계수**: 벡터 간 선형 상관관계
- **자카드 유사도**: 이진화된 벡터 교집합/합집합 비율

**🎯 STT 특화 메트릭 (stt-similarity.js):**
- **Jaro-Winkler 유사도**: 부분 일치 및 접두사 가중치 (STT 오인식 패턴)
  - 예시: "캔바" ↔ "캔바 캔" → 0.85+
  - 예시: "프로스케일러" ↔ "크로스케일러" → 0.75+
- **Levenshtein 유사도**: 편집 거리 기반 (글자 수정/삽입/삭제)
  - 예시: "도어 캠프" ↔ "도어캠" → 0.9+
  - 예시: "8인치" ↔ "알 인치" → 0.85+
- **Korean Phonetic 유사도**: 한국어 음성학적 혼동 패턴 (ㅍ↔ㅋ, ㅌ↔ㄷ, ㅔ↔ㅐ 등)
  - 예시: "티타늄" ↔ "티파늄" → 0.8+ (ㅌ/ㅍ 혼동)
  - 예시: "외부" ↔ "웨부" → 0.8+ (ㅚ/ㅞ 혼동)
- **STT Ensemble**: 임베딩 + STT 메트릭 앙상블 점수
  - 기본 가중평균: Jaro-Winkler 40% + Levenshtein 30% + Korean Phonetic 30%
  - (부분 일치를 가장 중시하는 휴리스틱 기반 설정, 실데이터 기반 최적화 가능)

### 4. 주요 기능 및 최신 업데이트

#### 4.1 🤖 AI 모델 지원
- **text-embedding-3-small** (기본, 경제적, 빠름)
- **text-embedding-3-large** (고정밀, 비용 높음, 느림)
- **OpenAI API 없이도 사용 가능** (전처리 + STT 메트릭만)
- UI에서 모델 선택 및 사용 여부 토글

#### 4.2 🎯 STT 특화 메트릭
- **음성 인식 오류 패턴 분석**: 한국어 발음 유사성 고려
- **하이브리드 앙상블**: 임베딩 + STT 메트릭 결합
- **실시간 토글**: STT 메트릭 활성화/비활성화 가능
- **전처리 단계별 STT 메트릭 계산**

#### 4.3 📊 고급 필터링 (load-json.html)
- **이중 필터 시스템**: 주요 유사도 & STT Ensemble 동시 필터
- **양방향 필터**: 이상(≥) & 이하(≤) 조건 지원
- **원본판정 필터**: True/False 항목 구분 분석
- **승인 추천 시스템**: 고품질 후보 자동 추천 (0.9/0.9 이상)

#### 4.4 🔄 유연한 전처리 옵션
- **선택적 단계 활성화**: 원본, 1-3단계, 1-4단계 체크박스 선택
- **전처리 비교 결과**: 각 단계별 유사도 비교 및 최적 방법 자동 선택
- **STT 메트릭과 연동**: 각 전처리 단계별 STT 점수 계산

#### 4.5 🖥️ 사용자 인터페이스
- **반응형 다크 테마**: #1a1a1a 배경, #4fc3f7 포인트 컬러
- **실시간 상태 관리**: 승인/거절 상태 시각적 표시
- **상세 정보 토글**: 유사도 상세보기, STT 메트릭 확장/축소
- **전처리 비교 시각화**: 단계별 결과 비교 및 최적 방법 표시

#### 4.6 📤 다양한 내보내기 옵션
- **JSON 내보내기**: 완전한 분석 결과 (STT 메트릭 포함)
- **Excel 내보내기**: 4개 시트 (요약, 상세, 전처리 비교, 원본 데이터)
- **PDF 내보내기**: 모든 상세보기 펼친 상태로 시각적 보고서

#### 4.7 🔍 디버그 및 모니터링
- **3단계 로그 레벨**: 기본(0) → 상세(1) → 모든 로그(2)
- **실시간 조정**: UI에서 디버그 레벨 즉시 변경
- **배치 처리 모니터링**: API 호출 절약률, 중복 제거 통계
- **성능 최적화 로그**: 처리 시간, 메모리 사용량 추적

### 5. 파일 구조 및 역할

#### 5.1 메인 애플리케이션
- **`index.html`**: 메인 분석 도구 (1,603줄)
  - 데이터 입력, 전처리, 분석, 결과 표시
  - STT 메트릭 토글, 승인/거절 관리
- **`load-json.html`**: JSON 결과 뷰어 (50,291바이트)
  - 분석 완료된 JSON 파일 로드 및 시각화
  - 고급 필터링, 승인 추천 시스템

#### 5.2 핵심 모듈
- **`parser.js`**: CSV/TSV 데이터 파싱 및 그룹핑
- **`similarity.js`**: 임베딩 기반 유사도 계산
- **`stt-similarity.js`**: STT 특화 메트릭 계산
- **`preprocessing.js`**: 정방향 텍스트 전처리
- **`displayResults.js`**: 결과 표시 및 렌더링
- **`management.js`**: 승인/거절, 내보내기 관리 (PDF 포함)

#### 5.3 설정 및 스타일
- **`config.js`**: OpenAI API 키 설정
- **`styles.css`**: 다크 테마 통합 스타일시트

=============================================================================

## 기능
1. **데이터 분석**: CSV/TSV 형태의 데이터를 파싱하고 그룹핑
2. **AI 분석**: OpenAI의 임베딩 모델을 사용한 유사도 분석 (multiple models 지원)
3. **텍스트 전처리**: 4단계 전처리 파이프라인 (선택적 적용)
4. **운영자 UI**: 분석 결과를 시각적으로 표시하고 승인/거절 관리
5. **디버그 모드**: 3단계 로그 레벨로 분석 과정 모니터링

## 사용 방법

### 1. 파일 실행
`index.html` 파일을 브라우저에서 열기

### 2. API 키 설정
OpenAI API 키를 입력란에 입력

### 3. 데이터 입력
CSV 형식의 데이터를 텍스트 영역에 입력
- 형식: `컬럼1,퀴즈ID,컬럼3,컬럼4,컬럼5,컬럼6,컬럼7,정답,컬럼9,사용자답변`
- 예시 데이터는 `데이터 형식` 참고

### 4. 분석 실행
"분석 시작" 버튼 클릭

### 5. 결과 확인 및 승인/거절
- 각 정답별로 유사어 후보들이 유사도와 출현횟수와 함께 표시됩니다
- 각 후보에 대해 "승인" 또는 "거절" 버튼으로 관리할 수 있습니다 (TOBE)

## 데이터 형식
```
47,1234,15,false,,WORD_SIMILARITY_PASS_FAIL_V2,,스냅드래곤 8,,스냅드래 곰파에
```

## 출력 형식
```json
[
  {
    "id": 1,
    "log_user_id": "6499",
    "expected_answer": "스냅드래곤 8",
    "candidates": [
      {"word": "스냅드래곤", "similarity": 0.91, "count": 1},
      {"word": "스냅드래 곰파에", "similarity": 0.88, "count": 1},
      {"word": "스냅드레곤", "similarity": 0.85, "count": 1}
    ]
  }
]
```

## 필요사항
- OpenAI API 키

## 주요 특징
- 유사도에 따른 색상 구분 (높음: 초록, 중간: 주황, 낮음: 빨강)
- 실시간 승인/거절 상태 표시


